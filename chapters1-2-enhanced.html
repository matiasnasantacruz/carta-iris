<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestra Historia - Capítulos 1 y 2</title>
    <meta name="description" content="Una historia de amor interactiva. Capítulo 1 expresivo y Capítulo 2 íntimo con metáforas de tormenta.">
    
    <style>
        /* ===== CSS RESET & FOUNDATION ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light theme colors */
            --bg-primary: #fdf8f5;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d1810;
            --text-secondary: #5a453a;
            --text-muted: #8b7865;
            --accent-primary: #d4879c;
            --accent-secondary: #e6a8bb;
            --accent-tertiary: #f2c8d4;
            --border-light: #e8ddd6;
            --border-medium: #d2c3b8;
            --shadow-light: rgba(45, 24, 16, 0.08);
            --shadow-medium: rgba(45, 24, 16, 0.15);
            --shadow-strong: rgba(45, 24, 16, 0.25);
            --heart-color: #ff6b9d;
            --success-color: #7fb069;
            --focus-color: #d4879c;
            --focus-outline: 2px solid var(--focus-color);
            --storm-blue: #4a6fa5;
            --storm-grey: #7a8199;
            --hope-blue: #5c7cfa;
        }

        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: #1a1410;
            --bg-secondary: #2d2520;
            --bg-card: #2d2520;
            --text-primary: #f5f0e8;
            --text-secondary: #d4c7b8;
            --text-muted: #a6968a;
            --accent-primary: #e6a8bb;
            --accent-secondary: #d4879c;
            --accent-tertiary: #c2667d;
            --border-light: #3d342d;
            --border-medium: #4d453e;
            --shadow-light: rgba(0, 0, 0, 0.2);
            --shadow-medium: rgba(0, 0, 0, 0.4);
            --shadow-strong: rgba(0, 0, 0, 0.6);
            --heart-color: #ff8cb3;
            --success-color: #8fbc7a;
            --focus-color: #e6a8bb;
            --storm-blue: #6c8cd5;
            --storm-grey: #9ca3bf;
            --hope-blue: #748ffc;
        }

        /* ===== GLOBAL STYLES ===== */
        body {
            font-family: 'Georgia', 'Times New Roman', serif; /* More letter-like font */
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== ACCESSIBILITY ===== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        :focus-visible {
            outline: var(--focus-outline);
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* Skip link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 8px;
            background: var(--accent-primary);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 8px;
        }

        /* ===== LAYOUT COMPONENTS ===== */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER ===== */
        .header {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow-light);
            border: 1px solid var(--border-light);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 0;
        }

        .controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 44px;
            min-width: 44px;
            justify-content: center;
        }

        .btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px var(--shadow-medium);
        }

        .btn-icon {
            padding: 0.5rem;
            min-width: 44px;
            font-size: 1.1rem;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
        }

        .btn-secondary:hover {
            background: var(--border-light);
        }

        /* ===== PROGRESS BAR ===== */
        .progress-section {
            margin-top: 1rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-dots {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-medium);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            position: relative;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-dot::before {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-medium);
            transition: all 0.2s ease;
        }

        .progress-dot.active::before {
            background: var(--accent-primary);
            transform: scale(1.2);
        }

        .progress-dot.completed::before {
            background: var(--success-color);
        }

        .progress-dot:hover::before {
            transform: scale(1.3);
            background: var(--accent-secondary);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 3rem; /* More spacious for letter style */
            box-shadow: 0 4px 20px var(--shadow-light);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .chapter-header {
            text-align: center;
            margin-bottom: 3rem; /* More space for letter feel */
        }

        .chapter-title {
            font-size: 1.6rem;
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
            font-weight: 700;
            font-family: 'Georgia', serif;
        }

        .chapter-content {
            font-size: 1.15rem; /* Slightly larger for readability */
            line-height: 2; /* Generous line height for letter style */
            color: var(--text-primary);
            max-width: 100%;
        }

        .chapter-content p {
            margin-bottom: 2.5rem; /* Airy spacing between paragraphs */
        }

        .chapter-content p:last-child {
            margin-bottom: 0;
        }

        /* ===== CHAPTER 1 EXPRESSIVE STYLES ===== */
        /* Italic text for thoughts */
        .chapter-content em,
        .chapter-content i {
            font-style: italic;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Bold text for emphasis */
        .chapter-content strong,
        .chapter-content b {
            font-weight: 700;
            color: var(--accent-primary);
        }

        /* Handwriting style for affectionate phrases */
        .affection {
            font-family: 'Brush Script MT', cursive, system-ui;
            font-size: 1.3em;
            color: var(--heart-color);
            font-weight: 600;
        }

        /* Animated emphasis words */
        .passion-word {
            display: inline-block;
            animation: passionPulse 2s ease-in-out infinite;
            font-weight: 900;
            background: linear-gradient(45deg, #ff6b9d, #d4879c, #ff6b9d);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: passionPulse 2s ease-in-out infinite, gradientShift 3s ease-in-out infinite;
        }

        .surprise-word {
            display: inline-block;
            animation: surpriseScale 1.5s ease-in-out infinite;
            font-weight: 900;
            color: var(--accent-primary);
            text-shadow: 0 0 10px rgba(212, 135, 156, 0.3);
        }

        .perfect-word {
            display: inline-block;
            font-family: 'Brush Script MT', cursive, system-ui;
            font-size: 1.4em;
            animation: perfectGlow 2.5s ease-in-out infinite;
            color: var(--heart-color);
        }

        /* ===== CHAPTER 2 STORM STYLES ===== */
        .faded {
            color: #aaa;
            font-style: italic;
            opacity: 0.7;
        }

        .storm-word {
            color: var(--storm-grey);
            font-weight: 600;
            animation: stormFade 3s ease-in-out;
        }

        .refuge-word {
            color: var(--storm-blue);
            font-weight: 600;
            background: linear-gradient(135deg, var(--storm-blue), var(--hope-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .promise-pulse {
            animation: promisePulse 3s ease-in-out;
            font-weight: 700;
        }

        .hope-blue {
            color: var(--hope-blue);
            font-size: 1.2em;
            text-shadow: 0 0 8px rgba(92, 124, 250, 0.3);
        }

        .storm-emoji {
            font-size: 1.3em;
            filter: drop-shadow(0 0 4px rgba(74, 111, 165, 0.4));
        }

        /* ===== ANIMATIONS ===== */
        @keyframes passionPulse {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.05);
                filter: brightness(1.2);
            }
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes surpriseScale {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
            }
            25% { 
                transform: scale(1.1) rotate(1deg);
            }
            75% { 
                transform: scale(1.1) rotate(-1deg);
            }
        }

        @keyframes perfectGlow {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 5px rgba(255, 107, 157, 0.3);
            }
            50% { 
                transform: scale(1.08);
                text-shadow: 0 0 15px rgba(255, 107, 157, 0.6), 0 0 25px rgba(255, 107, 157, 0.4);
            }
        }

        @keyframes stormFade {
            0% { 
                color: #ccc;
                opacity: 0.5;
            }
            100% { 
                color: var(--storm-grey);
                opacity: 1;
            }
        }

        @keyframes promisePulse {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.02);
                color: var(--accent-primary);
                text-shadow: 0 0 10px rgba(212, 135, 156, 0.3);
            }
        }

        /* ===== FLOATING ELEMENTS ===== */
        .floating-heart {
            display: block;
            text-align: center;
            font-size: 1.5rem;
            margin: 1.5rem 0;
            animation: floatGentle 3s ease-in-out infinite;
            opacity: 0.8;
        }

        .floating-spark {
            display: block;
            text-align: center;
            font-size: 1.2rem;
            margin: 1rem 0;
            animation: sparkle 2s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes floatGentle {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg);
                opacity: 0.8;
            }
            50% { 
                transform: translateY(-8px) rotate(5deg);
                opacity: 1;
            }
        }

        @keyframes sparkle {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                opacity: 0.7;
            }
            25% { 
                transform: scale(1.2) rotate(90deg);
                opacity: 1;
            }
            50% { 
                transform: scale(0.8) rotate(180deg);
                opacity: 0.9;
            }
            75% { 
                transform: scale(1.1) rotate(270deg);
                opacity: 1;
            }
        }

        /* ===== RAINDROP ANIMATION ===== */
        .raindrop {
            position: absolute;
            top: -20px;
            font-size: 1rem;
            opacity: 0.6;
            pointer-events: none;
            animation: rainFall 4s linear forwards;
            z-index: 10;
        }

        @keyframes rainFall {
            0% {
                top: -20px;
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                top: 100vh;
                opacity: 0;
            }
        }

        /* Large emojis for dramatic effect */
        .large-emoji {
            font-size: 1.3em;
            margin: 0 0.2em;
        }

        .huge-emoji {
            font-size: 1.8em;
            margin: 0 0.3em;
            display: inline-block;
            animation: emojiPulse 2s ease-in-out infinite;
        }

        @keyframes emojiPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .typewriter-controls {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
            gap: 0.75rem;
        }

        /* ===== NAVIGATION ===== */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow-light);
            border: 1px solid var(--border-light);
            margin-bottom: 1rem;
        }

        .nav-btn {
            flex: 1;
            max-width: 200px;
        }

        .heart-btn {
            background: var(--heart-color);
            font-size: 1.5rem;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .heart-btn:hover {
            background: var(--heart-color);
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }

        /* ===== HEARTS ANIMATION ===== */
        .hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            color: var(--heart-color);
            font-size: 1.5rem;
            opacity: 0;
            pointer-events: none;
            user-select: none;
            animation: floatUp 3s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.8) rotate(0deg);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-50vh) scale(1) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-100vh) scale(0.6) rotate(360deg);
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 600px) {
            .container {
                padding: 0.75rem;
            }

            .header,
            .main-content,
            .navigation {
                padding: 1rem;
                border-radius: 12px;
            }

            .main-content {
                padding: 2rem 1rem;
            }

            .title {
                font-size: 1.4rem;
            }

            .header-top {
                flex-direction: column;
                text-align: center;
            }

            .controls {
                justify-content: center;
            }

            .navigation {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-btn {
                max-width: none;
                width: 100%;
            }

            .chapter-title {
                font-size: 1.3rem;
            }

            .chapter-content {
                font-size: 1rem;
                line-height: 1.8;
            }

            .chapter-content p {
                margin-bottom: 2rem;
            }
        }

        @media (max-width: 360px) {
            .container {
                padding: 0.5rem;
            }

            .btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }

        /* ===== REDUCED MOTION ===== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .heart,
            .raindrop {
                display: none;
            }

            .passion-word,
            .surprise-word,
            .perfect-word,
            .floating-heart,
            .floating-spark,
            .huge-emoji,
            .storm-word,
            .promise-pulse {
                animation: none !important;
                transform: none !important;
            }
        }

        /* ===== HIGH CONTRAST MODE ===== */
        @media (prefers-contrast: high) {
            :root {
                --shadow-light: rgba(0, 0, 0, 0.3);
                --shadow-medium: rgba(0, 0, 0, 0.5);
                --shadow-strong: rgba(0, 0, 0, 0.7);
                --border-light: #666;
                --border-medium: #333;
            }

            .btn {
                border: 2px solid currentColor;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to content link for screen readers -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

    <!-- Hearts animation container -->
    <div class="hearts-container" id="hearts-container" aria-hidden="true"></div>

    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="header-top">
                <h1 class="title">Nuestra Historia ❤️</h1>
                <div class="controls">
                    <button type="button" class="btn btn-icon" id="theme-toggle" aria-label="Cambiar tema" title="Cambiar tema">
                        🌙
                    </button>
                </div>
            </div>
            
            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-text" id="progress-text">Capítulo 1 de 2</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 50%"></div>
                </div>
                <nav class="progress-dots" role="navigation" aria-label="Navegación por capítulos">
                    <button type="button" class="progress-dot active" data-chapter="1" aria-label="Capítulo 1" aria-current="true"></button>
                    <button type="button" class="progress-dot" data-chapter="2" aria-label="Capítulo 2"></button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <article class="chapter-header">
                <h2 class="chapter-title" id="chapter-title">1 - Los inicios</h2>
            </article>
            
            <div class="chapter-content" id="chapter-content" aria-live="polite">
                <!-- Chapter content will be inserted here -->
            </div>

            <div class="typewriter-controls" id="typewriter-controls" style="display: none;">
                <button type="button" class="btn btn-secondary" id="skip-animation">
                    ⏭️ Saltar animación
                </button>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="navigation" role="navigation" aria-label="Navegación entre capítulos">
            <button type="button" class="btn nav-btn" id="prev-btn" disabled>
                ⬅️ Anterior
            </button>
            
            <button type="button" class="btn heart-btn" id="heart-btn" aria-label="Crear corazones" title="Crear corazones">
                ❤️
            </button>
            
            <button type="button" class="btn nav-btn" id="next-btn">
                Siguiente ➡️
            </button>
        </nav>
    </div>

    <script>
        // ===== CHAPTER DATA =====
        const CHAPTERS = [
            {
                id: 1,
                title: "1 - Los inicios",
                body: `Yo ya te conocía de antes… siempre hablaban de vos como una persona con mucha proyección ✨ muy hábil y que eras un bochooo.
*Ya desde ahí quería conocerte en persona.*

Un día… 📲 me mandaste un par de solicitudes y ya de ahí nos empezamos a seguir en redes. Sin hablar todavía. Habíamos tenido antes un contacto por el tema de armar currículums.
Hasta que..... ¡Diste el primer paso! 😏
Yo tenía una resaca y vos me habías preguntado si no estaba enfermo o algo jajajajja. Esa noche hablamos hasta las 2 am ⏰ (sí, domingo para lunes, yo al otro día laburaba). Pero no me importó: **me encantaba**.

Después tuvimos nuestra primera cita. La verdad: no teníamos mucho en común 🤷‍♂️. Yo hablaba un montón y vos casi nada… solo te reías con esa sonrisa ANGELICAL 🙈.
Pero ya ahí vi que eras hermosa 😍 y *completamente diferente*, con un aire de dulzura que sinceramente atrapó tanto mi curiosidad como mi atención 💖.

Nos vimos un par de veces más. Yo te llevaba a la escuela cositas para la merienda 🍪, hasta mate ☕. Detalles simples… pero llenos de ganas de cuidarte.

Y entonces… llega ese sábado 24 de agosto (OSEA HACE UN AÑO). Vos querías cocinar ñoquis 🍝 y me dijiste que los ibas a hacer en casa. Yo conseguí todo.
Estuviste hasta tarde, dale que dale, ¡y terminamos comiendo a la 1 de la mañana! 😂

Esa noche… después de los ñoquis…
🔥 **tuvimos EL momento de PASIÓN** 🔥

Y en medio de todo… nos miramos… y sin pensarlo…
💍 **NOS OFICIALIZAMOS COMO PAREJA.**
Inesperado. Loco. Raro. ESPONTÁNEO.
Pero absolutamente **perfecto** 🥰.`
            },
            {
                id: 2,
                title: "Capítulo 2 – La tormenta",
                body: `Amor mío,

Al poco de empezar a salir, nos tocó atravesar una **tormenta** 🌧️ que puso todo a prueba. Fue un momento cargado de dudas, de miedos, de heridas viejas que volvieron a abrirse. Ahí entendí lo difícil que había sido para vos confiar, lo mucho que habías cargado en silencio 💔.

*Yo no sabía cómo iba a terminar todo.*
Lo más fácil hubiera sido alejarme, decir "hasta acá llegué"… pero dentro mío había algo más fuerte: **la fe en vos, en tu fuerza, en lo que podías lograr**. Y por eso decidí quedarme. ⚡

**Me prometí no abandonarte en tu momento más difícil.**
Preferí ser tu refugio, aunque no siempre supiera cómo hacerlo perfecto. Te acompañé como pude: con mis palabras, con mis gestos, con mi presencia.

Esos meses fueron duros… hubo momentos en que sentimos que todo podía terminar.
<span class="faded">Las discusiones, las diferencias, las dudas pesaban mucho…</span>
Pero aun así, vos seguías ahí conmigo y yo seguía queriéndote 💙.

No teníamos tantas cosas en común, no éramos una pareja de película 🎬 en esos inicios…
pero había algo mucho más real: un vínculo que, aunque frágil, seguía sosteniéndonos.

Hoy, mirando hacia atrás, me enorgullece haberme quedado 🌈.
Porque elegí la versión más difícil, sí… pero también la más verdadera: quedarme con vos, apostar por vos, cuando más lo necesitabas.`
            }
        ];

        // ===== APPLICATION STATE =====
        class LoveStoryApp {
            constructor() {
                this.currentChapter = 1;
                this.isTypewriting = false;
                this.typewriterTimeout = null;
                this.typewriterEnabled = true;
                this.heartPool = [];
                
                this.init();
            }

            // ===== INITIALIZATION =====
            init() {
                this.setupEventListeners();
                this.initTheme();
                this.renderChapter(this.currentChapter);
                this.updateProgress();
            }

            // ===== EVENT LISTENERS =====
            setupEventListeners() {
                // Navigation buttons
                document.getElementById('prev-btn').addEventListener('click', () => this.goToPreviousChapter());
                document.getElementById('next-btn').addEventListener('click', () => this.goToNextChapter());
                
                // Progress dots
                document.querySelectorAll('.progress-dot').forEach(dot => {
                    dot.addEventListener('click', (e) => {
                        const chapter = parseInt(e.target.dataset.chapter);
                        this.goToChapter(chapter);
                    });
                });

                // Heart button
                document.getElementById('heart-btn').addEventListener('click', (e) => {
                    this.spawnHearts(e.clientX, e.clientY);
                });

                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());

                // Controls
                document.getElementById('skip-animation').addEventListener('click', () => this.skipTypewriter());

                // Keyboard navigation
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));
            }

            handleKeyboard(e) {
                switch (e.key) {
                    case 'ArrowRight':
                    case ' ':
                    case 'Enter':
                        e.preventDefault();
                        this.goToNextChapter();
                        break;
                    case 'ArrowLeft':
                    case 'Backspace':
                        e.preventDefault();
                        this.goToPreviousChapter();
                        break;
                    case 'Escape':
                        if (this.isTypewriting) {
                            this.skipTypewriter();
                        }
                        break;
                    case 't':
                    case 'T':
                        this.typewriterEnabled = !this.typewriterEnabled;
                        break;
                }
            }

            // ===== CHAPTER NAVIGATION =====
            goToChapter(chapterNumber) {
                if (chapterNumber < 1 || chapterNumber > 2) return;

                this.currentChapter = chapterNumber;
                this.renderChapter(chapterNumber);
                this.updateProgress();
                this.spawnHeartsRandom();
            }

            goToNextChapter() {
                if (this.currentChapter < 2) {
                    this.goToChapter(this.currentChapter + 1);
                }
            }

            goToPreviousChapter() {
                if (this.currentChapter > 1) {
                    this.goToChapter(this.currentChapter - 1);
                }
            }

            // ===== CHAPTER RENDERING =====
            renderChapter(chapterNumber) {
                const chapter = CHAPTERS.find(c => c.id === chapterNumber);
                if (!chapter) return;

                // Update title
                document.getElementById('chapter-title').textContent = chapter.title;

                // Clear content
                const contentEl = document.getElementById('chapter-content');
                contentEl.innerHTML = '';

                // Add chapter-specific class
                const mainContent = document.getElementById('main-content');
                mainContent.className = `main-content chapter-${chapterNumber}`;

                // Split body into paragraphs
                const paragraphs = chapter.body.split('\n').filter(p => p.trim());

                if (this.typewriterEnabled) {
                    this.typewriterRender(contentEl, paragraphs, chapterNumber);
                } else {
                    this.instantRender(contentEl, paragraphs, chapterNumber);
                }

                // Update navigation buttons
                document.getElementById('prev-btn').disabled = chapterNumber === 1;
                document.getElementById('next-btn').disabled = chapterNumber === 2;

                // Scroll to top of content
                document.getElementById('main-content').scrollIntoView({ behavior: 'smooth' });
            }

            instantRender(contentEl, paragraphs, chapterNumber) {
                paragraphs.forEach((paragraph, index) => {
                    const p = document.createElement('p');
                    
                    if (chapterNumber === 1) {
                        p.innerHTML = this.processChapter1Content(paragraph);
                        
                        // Add floating elements for Chapter 1
                        if (index === 2) {
                            const heart = document.createElement('div');
                            heart.className = 'floating-heart';
                            heart.innerHTML = '💕';
                            contentEl.appendChild(heart);
                        }
                        if (index === 5) {
                            const spark = document.createElement('div');
                            spark.className = 'floating-spark';
                            spark.innerHTML = '✨';
                            contentEl.appendChild(spark);
                        }
                    } else if (chapterNumber === 2) {
                        p.innerHTML = this.processChapter2Content(paragraph);
                        
                        // Add raindrop elements for Chapter 2
                        if (index === 1) {
                            this.createRainDrops();
                        }
                    } else {
                        p.textContent = paragraph;
                    }
                    
                    contentEl.appendChild(p);
                });
                this.hideTypewriterControls();
            }

            typewriterRender(contentEl, paragraphs, chapterNumber) {
                this.isTypewriting = true;
                this.showTypewriterControls();
                
                let paragraphIndex = 0;
                let charIndex = 0;
                let currentP = null;

                const typeNextChar = () => {
                    if (paragraphIndex >= paragraphs.length) {
                        this.isTypewriting = false;
                        this.hideTypewriterControls();
                        return;
                    }

                    if (charIndex === 0) {
                        currentP = document.createElement('p');
                        contentEl.appendChild(currentP);
                        
                        // Add floating elements during typewriter
                        if (chapterNumber === 1) {
                            if (paragraphIndex === 2) {
                                const heart = document.createElement('div');
                                heart.className = 'floating-heart';
                                heart.innerHTML = '💕';
                                contentEl.appendChild(heart);
                            }
                            if (paragraphIndex === 5) {
                                const spark = document.createElement('div');
                                spark.className = 'floating-spark';
                                spark.innerHTML = '✨';
                                contentEl.appendChild(spark);
                            }
                        } else if (chapterNumber === 2 && paragraphIndex === 1) {
                            this.createRainDrops();
                        }
                    }

                    const currentParagraph = paragraphs[paragraphIndex];
                    
                    if (chapterNumber === 1) {
                        const processedContent = this.processChapter1Content(currentParagraph.slice(0, charIndex + 1));
                        currentP.innerHTML = processedContent;
                    } else if (chapterNumber === 2) {
                        const processedContent = this.processChapter2Content(currentParagraph.slice(0, charIndex + 1));
                        currentP.innerHTML = processedContent;
                    } else {
                        currentP.textContent = currentParagraph.slice(0, charIndex + 1);
                    }
                    
                    charIndex++;

                    if (charIndex >= currentParagraph.length) {
                        paragraphIndex++;
                        charIndex = 0;
                        this.typewriterTimeout = setTimeout(typeNextChar, 300);
                    } else {
                        this.typewriterTimeout = setTimeout(typeNextChar, 40);
                    }
                };

                typeNextChar();
            }

            processChapter1Content(text) {
                return text
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/PASIÓN/g, '<span class="passion-word">PASIÓN</span>')
                    .replace(/NOS OFICIALIZAMOS COMO PAREJA/g, '<span class="surprise-word">NOS OFICIALIZAMOS COMO PAREJA</span>')
                    .replace(/perfecto/g, '<span class="perfect-word">perfecto</span>')
                    .replace(/me encantaba/g, '<span class="affection">me encantaba</span>')
                    .replace(/atrapó tanto mi curiosidad como mi atención/g, '<span class="affection">atrapó tanto mi curiosidad como mi atención</span>')
                    .replace(/🔥/g, '<span class="huge-emoji">🔥</span>')
                    .replace(/💍/g, '<span class="huge-emoji">💍</span>')
                    .replace(/💖/g, '<span class="large-emoji">💖</span>')
                    .replace(/😍/g, '<span class="large-emoji">😍</span>')
                    .replace(/🥰/g, '<span class="large-emoji">🥰</span>');
            }

            processChapter2Content(text) {
                return text
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/tormenta/g, '<span class="storm-word">tormenta</span>')
                    .replace(/refugio/g, '<span class="refuge-word">refugio</span>')
                    .replace(/Me prometí no abandonarte en tu momento más difícil/g, '<span class="promise-pulse">Me prometí no abandonarte en tu momento más difícil</span>')
                    .replace(/💙/g, '<span class="hope-blue">💙</span>')
                    .replace(/🌈/g, '<span class="hope-blue">🌈</span>')
                    .replace(/🌧️/g, '<span class="storm-emoji">🌧️</span>')
                    .replace(/⚡/g, '<span class="storm-emoji">⚡</span>')
                    .replace(/💔/g, '<span class="storm-emoji">💔</span>');
            }

            createRainDrops() {
                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    return;
                }

                const container = document.getElementById('hearts-container');
                const dropCount = 6;
                
                for (let i = 0; i < dropCount; i++) {
                    setTimeout(() => {
                        const drop = document.createElement('div');
                        drop.className = 'raindrop';
                        drop.textContent = '💧';
                        
                        drop.style.left = `${Math.random() * 100}%`;
                        drop.style.animationDelay = `${Math.random() * 2}s`;
                        drop.style.animationDuration = `${3 + Math.random() * 2}s`;
                        
                        container.appendChild(drop);
                        
                        setTimeout(() => {
                            if (drop.parentNode) {
                                drop.parentNode.removeChild(drop);
                            }
                        }, 5000);
                    }, i * 200);
                }
            }

            skipTypewriter() {
                if (!this.isTypewriting) return;
                
                clearTimeout(this.typewriterTimeout);
                this.isTypewriting = false;
                this.hideTypewriterControls();
                
                const chapter = CHAPTERS.find(c => c.id === this.currentChapter);
                const contentEl = document.getElementById('chapter-content');
                const paragraphs = chapter.body.split('\n').filter(p => p.trim());
                
                this.instantRender(contentEl, paragraphs, this.currentChapter);
            }

            showTypewriterControls() {
                document.getElementById('typewriter-controls').style.display = 'flex';
            }

            hideTypewriterControls() {
                document.getElementById('typewriter-controls').style.display = 'none';
            }

            // ===== PROGRESS MANAGEMENT =====
            updateProgress() {
                document.getElementById('progress-text').textContent = `Capítulo ${this.currentChapter} de 2`;
                
                const percentage = (this.currentChapter / 2) * 100;
                document.getElementById('progress-fill').style.width = `${percentage}%`;
                
                document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                    const chapterNum = index + 1;
                    dot.classList.remove('active', 'completed');
                    dot.removeAttribute('aria-current');
                    
                    if (chapterNum === this.currentChapter) {
                        dot.classList.add('active');
                        dot.setAttribute('aria-current', 'true');
                    } else if (chapterNum < this.currentChapter) {
                        dot.classList.add('completed');
                    }
                });
            }

            // ===== THEME MANAGEMENT =====
            initTheme() {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    document.body.setAttribute('data-theme', 'dark');
                    this.updateThemeToggle(true);
                } else {
                    this.updateThemeToggle(false);
                }
            }

            toggleTheme() {
                const isDark = document.body.hasAttribute('data-theme');
                
                if (isDark) {
                    document.body.removeAttribute('data-theme');
                    this.updateThemeToggle(false);
                } else {
                    document.body.setAttribute('data-theme', 'dark');
                    this.updateThemeToggle(true);
                }
            }

            updateThemeToggle(isDark) {
                const themeBtn = document.getElementById('theme-toggle');
                themeBtn.textContent = isDark ? '☀️' : '🌙';
                themeBtn.setAttribute('aria-label', isDark ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro');
            }

            // ===== HEARTS ANIMATION =====
            spawnHearts(x, y) {
                const container = document.getElementById('hearts-container');
                const heartCount = 12;
                
                for (let i = 0; i < heartCount; i++) {
                    setTimeout(() => {
                        this.createHeart(x, y, container);
                    }, i * 100);
                }
            }

            spawnHeartsRandom() {
                const container = document.getElementById('hearts-container');
                const heartCount = 6;
                
                for (let i = 0; i < heartCount; i++) {
                    setTimeout(() => {
                        const x = Math.random() * window.innerWidth;
                        const y = window.innerHeight - 100;
                        this.createHeart(x, y, container);
                    }, i * 150);
                }
            }

            createHeart(x, y, container) {
                if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                    return;
                }

                let heart;
                
                if (this.heartPool.length > 0) {
                    heart = this.heartPool.pop();
                } else {
                    heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.textContent = '❤️';
                }

                heart.style.left = `${x - 12}px`;
                heart.style.top = `${y - 12}px`;
                heart.style.animation = 'none';
                
                container.appendChild(heart);
                
                requestAnimationFrame(() => {
                    heart.style.animation = 'floatUp 3s ease-out forwards';
                });

                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                        this.heartPool.push(heart);
                    }
                }, 3000);
            }
        }

        // ===== APPLICATION INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            window.loveStoryApp = new LoveStoryApp();
        });
    </script>
</body>
</html>

<!--
=== DEV NOTES ===

ENHANCED CHAPTER 2 - STORM THEME:
- Intimate letter style speaking directly to "her" with "Amor mío" opening
- Storm metaphors with visual accompaniment (raindrops, faded text, storm colors)
- Blue tones for hope and refuge elements
- Animated "tormenta" word with fade-in effect
- Promise phrase pulses softly once
- Raindrops (💧) fall slowly in background when storm paragraph loads
- Faded grey text for moments of doubt

TYPOGRAPHY & STYLING:
- Serif font (Georgia) for more letter-like feel
- Generous spacing: 2.5rem between paragraphs, line-height 2
- Larger padding for letter card style (3rem)
- Delicate animations that respect accessibility preferences

STORM-SPECIFIC STYLES:
- .faded: grey italic text for doubt moments
- .storm-word: animated fade-in for "tormenta"
- .refuge-word: blue gradient for "refugio"
- .promise-pulse: gentle pulse animation for key promise
- .hope-blue: blue tones for 💙 and 🌈
- .storm-emoji: dramatic styling for 🌧️⚡💔

INTERACTIONS:
- All Chapter 1 features maintained
- Chapter 2 adds raindrop animation
- Smooth transitions between chapters
- Keyboard navigation (arrows, space, escape)
- Theme toggle and typewriter controls

ACCESSIBILITY:
- Reduced motion support disables all animations
- High contrast mode adjustments
- Keyboard navigation
- ARIA labels and semantic HTML
- Skip links for screen readers
-->
